2022-11-09 16:15:54.908 +01:00 [INF] Request starting HTTP/2 GET https://localhost:7145/api/Car - -
2022-11-09 16:15:54.938 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo: '08/11/2022 15:35:15', Current time: '09/11/2022 15:15:54'.
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at System.IdentityModel.Tokens.Jwt.JwtSecurityTokenHandler.ValidateTokenPayload(JwtSecurityToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at System.IdentityModel.Tokens.Jwt.JwtSecurityTokenHandler.ValidateJWS(String token, TokenValidationParameters validationParameters, BaseConfiguration currentConfiguration, SecurityToken& signatureValidatedToken, ExceptionDispatchInfo& exceptionThrown)
--- End of stack trace from previous location ---
   at System.IdentityModel.Tokens.Jwt.JwtSecurityTokenHandler.ValidateToken(String token, JwtSecurityToken outerToken, TokenValidationParameters validationParameters, SecurityToken& signatureValidatedToken)
   at System.IdentityModel.Tokens.Jwt.JwtSecurityTokenHandler.ValidateToken(String token, TokenValidationParameters validationParameters, SecurityToken& validatedToken)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2022-11-09 16:15:55.002 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo: '08/11/2022 15:35:15', Current time: '09/11/2022 15:15:54'.
2022-11-09 16:15:55.004 +01:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (User|Admin)
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2022-11-09 16:15:55.019 +01:00 [INF] AuthenticationScheme: Bearer was challenged.
2022-11-09 16:15:55.020 +01:00 [INF] Request finished HTTP/2 GET https://localhost:7145/api/Car - - - 401 0 - 111.1765ms
2022-11-09 16:16:22.952 +01:00 [INF] Request starting HTTP/2 POST https://localhost:7145/api/Auth/Refresh application/json 485
2022-11-09 16:16:22.952 +01:00 [INF] CORS policy execution successful.
2022-11-09 16:16:22.955 +01:00 [INF] Executing endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-09 16:16:22.959 +01:00 [INF] Route matched with {action = "GetRefreshToken", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetRefreshToken(CarDealer.Models.Token) on controller CarDealer.Controllers.AuthController (CarDealer).
2022-11-09 16:16:22.966 +01:00 [INF] Entity Framework Core 6.0.10 initialized 'DataContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:6.0.10' with options: None
2022-11-09 16:16:22.972 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@__token_RefreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[Email], [u].[FirstName], [u].[LastName], [u].[PasswordHash], [u].[PasswordSalt], [u].[RefreshToken], [u].[Role], [u].[TokenCreated], [u].[TokenExpires], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[RefreshToken] = @__token_RefreshToken_0
2022-11-09 16:16:33.745 +01:00 [FTL] Object reference not set to an instance of an object.
2022-11-09 16:16:33.746 +01:00 [INF] Executing UnauthorizedObjectResult, writing value of type 'System.String'.
2022-11-09 16:16:33.746 +01:00 [INF] Executed action CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer) in 10787.6598ms
2022-11-09 16:16:33.747 +01:00 [INF] Executed endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-09 16:16:33.747 +01:00 [INF] Request finished HTTP/2 POST https://localhost:7145/api/Auth/Refresh application/json 485 - 401 - text/plain;+charset=utf-8 10795.2248ms
2022-11-09 16:16:45.190 +01:00 [INF] Request starting HTTP/2 POST https://localhost:7145/api/Auth/Refresh application/json 485
2022-11-09 16:16:45.191 +01:00 [INF] CORS policy execution successful.
2022-11-09 16:16:45.194 +01:00 [INF] Executing endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-09 16:16:45.196 +01:00 [INF] Route matched with {action = "GetRefreshToken", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetRefreshToken(CarDealer.Models.Token) on controller CarDealer.Controllers.AuthController (CarDealer).
2022-11-09 16:16:45.197 +01:00 [INF] Entity Framework Core 6.0.10 initialized 'DataContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:6.0.10' with options: None
2022-11-09 16:16:45.200 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[@__token_RefreshToken_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[Email], [u].[FirstName], [u].[LastName], [u].[PasswordHash], [u].[PasswordSalt], [u].[RefreshToken], [u].[Role], [u].[TokenCreated], [u].[TokenExpires], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[RefreshToken] = @__token_RefreshToken_0
2022-11-09 16:16:45.201 +01:00 [INF] Executing OkObjectResult, writing value of type 'CarDealer.Models.Token'.
2022-11-09 16:16:45.201 +01:00 [INF] Executed action CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer) in 5.2233ms
2022-11-09 16:16:45.201 +01:00 [INF] Executed endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-09 16:16:45.201 +01:00 [INF] Request finished HTTP/2 POST https://localhost:7145/api/Auth/Refresh application/json 485 - 200 - application/json;+charset=utf-8 11.8662ms
2022-11-09 16:17:29.065 +01:00 [INF] User profile is available. Using 'C:\Users\Filip\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2022-11-09 16:17:29.506 +01:00 [INF] Now listening on: https://localhost:7145
2022-11-09 16:17:29.506 +01:00 [INF] Now listening on: http://localhost:5145
2022-11-09 16:17:29.511 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2022-11-09 16:17:29.511 +01:00 [INF] Hosting environment: Development
2022-11-09 16:17:29.511 +01:00 [INF] Content root path: C:\Users\Work\source\repos\CarDealer\CarDealer\
2022-11-09 16:17:30.457 +01:00 [INF] Request starting HTTP/2 GET https://localhost:7145/swagger/index.html - -
2022-11-09 16:17:30.837 +01:00 [INF] Request finished HTTP/2 GET https://localhost:7145/swagger/index.html - - - 200 - text/html;charset=utf-8 383.1108ms
2022-11-09 16:17:30.938 +01:00 [INF] Request starting HTTP/2 GET https://localhost:7145/_vs/browserLink - -
2022-11-09 16:17:30.938 +01:00 [INF] Request starting HTTP/2 GET https://localhost:7145/_framework/aspnetcore-browser-refresh.js - -
2022-11-09 16:17:30.956 +01:00 [INF] Request finished HTTP/2 GET https://localhost:7145/_framework/aspnetcore-browser-refresh.js - - - 200 11988 application/javascript;+charset=utf-8 17.7344ms
2022-11-09 16:17:30.972 +01:00 [INF] Request finished HTTP/2 GET https://localhost:7145/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 34.2079ms
2022-11-09 16:17:31.100 +01:00 [INF] Request starting HTTP/2 GET https://localhost:7145/swagger/v1/swagger.json - -
2022-11-09 16:17:31.317 +01:00 [INF] Request finished HTTP/2 GET https://localhost:7145/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 217.3040ms
2022-11-09 16:18:03.796 +01:00 [INF] Request starting HTTP/2 POST https://localhost:7145/api/Auth/login application/json 53
2022-11-09 16:18:03.804 +01:00 [INF] CORS policy execution successful.
2022-11-09 16:18:03.892 +01:00 [INF] Executing endpoint 'CarDealer.Controllers.AuthController.Login (CarDealer)'
2022-11-09 16:18:03.912 +01:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Login(CarDealer.Domain.Auth.LoginDto) on controller CarDealer.Controllers.AuthController (CarDealer).
2022-11-09 16:18:05.133 +01:00 [INF] Entity Framework Core 6.0.10 initialized 'DataContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:6.0.10' with options: None
2022-11-09 16:18:06.058 +01:00 [INF] Executed DbCommand (62ms) [Parameters=[@__req_Username_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[Email], [u].[FirstName], [u].[LastName], [u].[PasswordHash], [u].[PasswordSalt], [u].[RefreshToken], [u].[Role], [u].[TokenCreated], [u].[TokenExpires], [u].[Username]
FROM [Users] AS [u]
WHERE ([u].[Username] = @__req_Username_0) OR ([u].[Email] = @__req_Username_0)
2022-11-09 16:18:06.442 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[@p3='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [RefreshToken] = @p0, [TokenCreated] = @p1, [TokenExpires] = @p2
WHERE [Id] = @p3;
SELECT @@ROWCOUNT;
2022-11-09 16:18:06.473 +01:00 [INF] Executing OkObjectResult, writing value of type 'CarDealer.Models.Token'.
2022-11-09 16:18:06.486 +01:00 [INF] Executed action CarDealer.Controllers.AuthController.Login (CarDealer) in 2564.228ms
2022-11-09 16:18:06.486 +01:00 [INF] Executed endpoint 'CarDealer.Controllers.AuthController.Login (CarDealer)'
2022-11-09 16:18:06.495 +01:00 [INF] Request finished HTTP/2 POST https://localhost:7145/api/Auth/login application/json 53 - 200 - application/json;+charset=utf-8 2698.1510ms
