2022-11-10 16:18:34.518 +01:00 [INF] Request starting HTTP/2 GET https://localhost:7145/api/Car - -
2022-11-10 16:18:34.632 +01:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo: '09/11/2022 15:38:06', Current time: '10/11/2022 15:18:34'.
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at System.IdentityModel.Tokens.Jwt.JwtSecurityTokenHandler.ValidateTokenPayload(JwtSecurityToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at System.IdentityModel.Tokens.Jwt.JwtSecurityTokenHandler.ValidateJWS(String token, TokenValidationParameters validationParameters, BaseConfiguration currentConfiguration, SecurityToken& signatureValidatedToken, ExceptionDispatchInfo& exceptionThrown)
--- End of stack trace from previous location ---
   at System.IdentityModel.Tokens.Jwt.JwtSecurityTokenHandler.ValidateToken(String token, JwtSecurityToken outerToken, TokenValidationParameters validationParameters, SecurityToken& signatureValidatedToken)
   at System.IdentityModel.Tokens.Jwt.JwtSecurityTokenHandler.ValidateToken(String token, TokenValidationParameters validationParameters, SecurityToken& validatedToken)
   at Microsoft.AspNetCore.Authentication.JwtBearer.JwtBearerHandler.HandleAuthenticateAsync()
2022-11-10 16:18:34.682 +01:00 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo: '09/11/2022 15:38:06', Current time: '10/11/2022 15:18:34'.
2022-11-10 16:18:34.691 +01:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (User|Admin)
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2022-11-10 16:18:34.708 +01:00 [INF] AuthenticationScheme: Bearer was challenged.
2022-11-10 16:18:34.708 +01:00 [INF] Request finished HTTP/2 GET https://localhost:7145/api/Car - - - 401 0 - 190.9575ms
2022-11-10 16:19:00.438 +01:00 [INF] Request starting HTTP/2 POST https://localhost:7145/api/Auth/Refresh application/json 485
2022-11-10 16:19:00.447 +01:00 [INF] CORS policy execution successful.
2022-11-10 16:19:00.448 +01:00 [INF] Executing endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-10 16:19:00.451 +01:00 [INF] Route matched with {action = "GetRefreshToken", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetRefreshToken(CarDealer.Models.Token) on controller CarDealer.Controllers.AuthController (CarDealer).
2022-11-10 16:19:00.562 +01:00 [FTL] Exception of type 'System.Exception' was thrown.
2022-11-10 16:19:00.563 +01:00 [INF] Executing UnauthorizedObjectResult, writing value of type 'System.String'.
2022-11-10 16:19:00.563 +01:00 [INF] Executed action CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer) in 112.6641ms
2022-11-10 16:19:00.563 +01:00 [INF] Executed endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-10 16:19:00.564 +01:00 [INF] Request finished HTTP/2 POST https://localhost:7145/api/Auth/Refresh application/json 485 - 401 - text/plain;+charset=utf-8 126.2435ms
2022-11-10 16:19:16.723 +01:00 [INF] Request starting HTTP/2 POST https://localhost:7145/api/Auth/Refresh application/json 485
2022-11-10 16:19:16.723 +01:00 [INF] CORS policy execution successful.
2022-11-10 16:19:16.723 +01:00 [INF] Executing endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-10 16:19:16.724 +01:00 [INF] Route matched with {action = "GetRefreshToken", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetRefreshToken(CarDealer.Models.Token) on controller CarDealer.Controllers.AuthController (CarDealer).
2022-11-10 16:19:16.763 +01:00 [FTL] Exception of type 'System.Exception' was thrown.
2022-11-10 16:19:16.763 +01:00 [INF] Executing UnauthorizedObjectResult, writing value of type 'System.String'.
2022-11-10 16:19:16.764 +01:00 [INF] Executed action CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer) in 39.9522ms
2022-11-10 16:19:16.764 +01:00 [INF] Executed endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-10 16:19:16.764 +01:00 [INF] Request finished HTTP/2 POST https://localhost:7145/api/Auth/Refresh application/json 485 - 401 - text/plain;+charset=utf-8 40.7922ms
2022-11-10 16:19:26.453 +01:00 [INF] Request starting HTTP/2 POST https://localhost:7145/api/Auth/Refresh application/json 485
2022-11-10 16:19:26.454 +01:00 [INF] CORS policy execution successful.
2022-11-10 16:19:26.454 +01:00 [INF] Executing endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-10 16:19:26.454 +01:00 [INF] Route matched with {action = "GetRefreshToken", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetRefreshToken(CarDealer.Models.Token) on controller CarDealer.Controllers.AuthController (CarDealer).
2022-11-10 16:19:26.486 +01:00 [FTL] Exception of type 'System.Exception' was thrown.
2022-11-10 16:19:26.486 +01:00 [INF] Executing UnauthorizedObjectResult, writing value of type 'System.String'.
2022-11-10 16:19:26.486 +01:00 [INF] Executed action CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer) in 32.3067ms
2022-11-10 16:19:26.486 +01:00 [INF] Executed endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-10 16:19:26.486 +01:00 [INF] Request finished HTTP/2 POST https://localhost:7145/api/Auth/Refresh application/json 485 - 401 - text/plain;+charset=utf-8 32.8290ms
2022-11-10 16:19:28.573 +01:00 [INF] Request starting HTTP/2 POST https://localhost:7145/api/Auth/Refresh application/json 485
2022-11-10 16:19:28.573 +01:00 [INF] CORS policy execution successful.
2022-11-10 16:19:28.573 +01:00 [INF] Executing endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-10 16:19:28.573 +01:00 [INF] Route matched with {action = "GetRefreshToken", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetRefreshToken(CarDealer.Models.Token) on controller CarDealer.Controllers.AuthController (CarDealer).
2022-11-10 16:19:28.605 +01:00 [FTL] Exception of type 'System.Exception' was thrown.
2022-11-10 16:19:28.605 +01:00 [INF] Executing UnauthorizedObjectResult, writing value of type 'System.String'.
2022-11-10 16:19:28.605 +01:00 [INF] Executed action CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer) in 31.9879ms
2022-11-10 16:19:28.605 +01:00 [INF] Executed endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-10 16:19:28.605 +01:00 [INF] Request finished HTTP/2 POST https://localhost:7145/api/Auth/Refresh application/json 485 - 401 - text/plain;+charset=utf-8 32.4422ms
2022-11-10 16:19:56.147 +01:00 [INF] Request starting HTTP/2 POST https://localhost:7145/api/Auth/Refresh application/json 485
2022-11-10 16:19:56.147 +01:00 [INF] CORS policy execution successful.
2022-11-10 16:19:56.148 +01:00 [INF] Executing endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-10 16:19:56.151 +01:00 [INF] Route matched with {action = "GetRefreshToken", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetRefreshToken(CarDealer.Models.Token) on controller CarDealer.Controllers.AuthController (CarDealer).
2022-11-10 16:19:56.196 +01:00 [FTL] Exception of type 'System.Exception' was thrown.
2022-11-10 16:19:56.197 +01:00 [INF] Executing UnauthorizedObjectResult, writing value of type 'System.String'.
2022-11-10 16:19:56.197 +01:00 [INF] Executed action CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer) in 36.7083ms
2022-11-10 16:19:56.197 +01:00 [INF] Executed endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-10 16:19:56.197 +01:00 [INF] Request finished HTTP/2 POST https://localhost:7145/api/Auth/Refresh application/json 485 - 401 - text/plain;+charset=utf-8 50.3691ms
2022-11-10 16:49:01.328 +01:00 [INF] User profile is available. Using 'C:\Users\Filip\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2022-11-10 16:49:01.805 +01:00 [INF] Now listening on: https://localhost:7145
2022-11-10 16:49:01.805 +01:00 [INF] Now listening on: http://localhost:5145
2022-11-10 16:49:01.809 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2022-11-10 16:49:01.809 +01:00 [INF] Hosting environment: Development
2022-11-10 16:49:01.809 +01:00 [INF] Content root path: C:\Users\Work\source\repos\CarDealer\CarDealer\
2022-11-10 16:49:02.941 +01:00 [INF] Request starting HTTP/2 GET https://localhost:7145/swagger/index.html - -
2022-11-10 16:49:03.345 +01:00 [INF] Request finished HTTP/2 GET https://localhost:7145/swagger/index.html - - - 200 - text/html;charset=utf-8 406.6475ms
2022-11-10 16:49:03.453 +01:00 [INF] Request starting HTTP/2 GET https://localhost:7145/_vs/browserLink - -
2022-11-10 16:49:03.453 +01:00 [INF] Request starting HTTP/2 GET https://localhost:7145/_framework/aspnetcore-browser-refresh.js - -
2022-11-10 16:49:03.468 +01:00 [INF] Request finished HTTP/2 GET https://localhost:7145/_framework/aspnetcore-browser-refresh.js - - - 200 11988 application/javascript;+charset=utf-8 14.8982ms
2022-11-10 16:49:03.488 +01:00 [INF] Request finished HTTP/2 GET https://localhost:7145/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 34.6641ms
2022-11-10 16:49:03.602 +01:00 [INF] Request starting HTTP/2 GET https://localhost:7145/swagger/v1/swagger.json - -
2022-11-10 16:49:03.851 +01:00 [INF] Request finished HTTP/2 GET https://localhost:7145/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 248.7193ms
2022-11-10 16:49:18.264 +01:00 [INF] Request starting HTTP/2 POST https://localhost:7145/api/Auth/login application/json 53
2022-11-10 16:49:18.272 +01:00 [INF] CORS policy execution successful.
2022-11-10 16:49:18.384 +01:00 [INF] Executing endpoint 'CarDealer.Controllers.AuthController.Login (CarDealer)'
2022-11-10 16:49:18.412 +01:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Login(CarDealer.Domain.Auth.LoginDto) on controller CarDealer.Controllers.AuthController (CarDealer).
2022-11-10 16:49:19.660 +01:00 [INF] Entity Framework Core 6.0.10 initialized 'DataContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:6.0.10' with options: None
2022-11-10 16:49:20.714 +01:00 [INF] Executed DbCommand (63ms) [Parameters=[@__req_Username_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[Email], [u].[FirstName], [u].[LastName], [u].[PasswordHash], [u].[PasswordSalt], [u].[RefreshToken], [u].[Role], [u].[TokenCreated], [u].[TokenExpires], [u].[Username]
FROM [Users] AS [u]
WHERE ([u].[Username] = @__req_Username_0) OR ([u].[Email] = @__req_Username_0)
2022-11-10 16:49:21.111 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[@p3='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [RefreshToken] = @p0, [TokenCreated] = @p1, [TokenExpires] = @p2
WHERE [Id] = @p3;
SELECT @@ROWCOUNT;
2022-11-10 16:49:21.140 +01:00 [INF] Executing OkObjectResult, writing value of type 'CarDealer.Models.Token'.
2022-11-10 16:49:21.150 +01:00 [INF] Executed action CarDealer.Controllers.AuthController.Login (CarDealer) in 2731.4552ms
2022-11-10 16:49:21.150 +01:00 [INF] Executed endpoint 'CarDealer.Controllers.AuthController.Login (CarDealer)'
2022-11-10 16:49:21.158 +01:00 [INF] Request finished HTTP/2 POST https://localhost:7145/api/Auth/login application/json 53 - 200 - application/json;+charset=utf-8 2894.0985ms
2022-11-10 16:49:34.570 +01:00 [INF] Request starting HTTP/2 GET https://localhost:7145/api/Car - -
2022-11-10 16:49:34.663 +01:00 [INF] Executing endpoint 'CarDealer.Controllers.CarController.GetAll (CarDealer)'
2022-11-10 16:49:34.664 +01:00 [INF] Route matched with {action = "GetAll", controller = "Car"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetAll() on controller CarDealer.Controllers.CarController (CarDealer).
2022-11-10 16:49:34.768 +01:00 [INF] Entity Framework Core 6.0.10 initialized 'DataContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:6.0.10' with options: None
2022-11-10 16:49:34.777 +01:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[Id], [c].[CarManufacturerId], [c].[CarType], [c].[Hp], [c].[Make], [c].[Model], [c].[Seats], [c].[Year]
FROM [Cars] AS [c]
2022-11-10 16:49:34.805 +01:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[CarDealer.Domain.Car.GetCarDto, CarDealer, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2022-11-10 16:49:34.809 +01:00 [INF] Executed action CarDealer.Controllers.CarController.GetAll (CarDealer) in 144.4453ms
2022-11-10 16:49:34.809 +01:00 [INF] Executed endpoint 'CarDealer.Controllers.CarController.GetAll (CarDealer)'
2022-11-10 16:49:34.809 +01:00 [INF] Request finished HTTP/2 GET https://localhost:7145/api/Car - - - 200 - application/json;+charset=utf-8 239.4940ms
2022-11-10 17:51:41.846 +01:00 [INF] Request starting HTTP/2 POST https://localhost:7145/api/Auth/Refresh?token=oy4JZFKLH2j8cqrjsrdG49KSKzbQact3wlD3CMNfCPg%3D - 0
2022-11-10 17:51:41.852 +01:00 [INF] CORS policy execution successful.
2022-11-10 17:51:41.856 +01:00 [INF] Executing endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-10 17:51:41.867 +01:00 [INF] Route matched with {action = "GetRefreshToken", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult GetRefreshToken(System.String) on controller CarDealer.Controllers.AuthController (CarDealer).
2022-11-10 17:51:41.878 +01:00 [INF] Entity Framework Core 6.0.10 initialized 'DataContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer:6.0.10' with options: None
2022-11-10 17:51:41.911 +01:00 [INF] Executed DbCommand (2ms) [Parameters=[@__token_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[Email], [u].[FirstName], [u].[LastName], [u].[PasswordHash], [u].[PasswordSalt], [u].[RefreshToken], [u].[Role], [u].[TokenCreated], [u].[TokenExpires], [u].[Username]
FROM [Users] AS [u]
WHERE [u].[RefreshToken] = @__token_0
2022-11-10 17:51:41.912 +01:00 [INF] Executing OkObjectResult, writing value of type 'System.String'.
2022-11-10 17:51:41.912 +01:00 [INF] Executed action CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer) in 44.5851ms
2022-11-10 17:51:41.912 +01:00 [INF] Executed endpoint 'CarDealer.Controllers.AuthController.GetRefreshToken (CarDealer)'
2022-11-10 17:51:41.912 +01:00 [INF] Request finished HTTP/2 POST https://localhost:7145/api/Auth/Refresh?token=oy4JZFKLH2j8cqrjsrdG49KSKzbQact3wlD3CMNfCPg%3D - 0 - 200 - text/plain;+charset=utf-8 65.9662ms
